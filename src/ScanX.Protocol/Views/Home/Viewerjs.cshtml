@model List<ScanX.Core.Models.ScannerDevice>

@{
    ViewData["Title"] = "Viewerjs";
}

@section styles{
    <link href="~/lib/viewerjs/dist/viewer.min.css" rel="stylesheet" />
    <link href="~/lib/simplebar/dist/simplebar.css" rel="stylesheet" />
}

    <div class="container content">

        <div class="row">
            <div class="col-10">
                <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mr-2" role="group" aria-label="First group">
                        <button type="button" class="btn btn-sm btn-primary" onclick="scanTest();">
                            Scan Test
                        </button>
                        <button type="button" class="btn btn-sm btn-primary" onclick="scanTest();">
                            <i class="fas fa-file"></i>
                            Scan Single Image
                        </button>
                        <button type="button" class="btn btn-sm btn-primary" onclick="scanTest();">
                            <i class="fas fa-copy"></i>
                            Scan All Images
                        </button>
                    </div>

                </div>
            </div>
        </div>



        <div class="row">
            <div class="col-10">
                <div style="height:750px;">
                    <img id="image-container" style="display:none;" />
                </div>
            </div>
            <div class="col-2 border" style="background-color:whitesmoke;">

                <div data-simplebar style="height:750px;">
                    <ul id="image-list" style="padding:20px;"></ul>
                </div>

            </div>
        </div>

        <br />
        <br />
    </div>


@section scripts{


    <script src="~/lib/viewerjs/dist/viewer.min.js"></script>

    <script src="~/js/signalr.min.js"></script>

    <script src="~/js/scanx.js"></script>

    <script src="~/lib/simplebar/dist/simplebar.js"></script>


    <script type="text/javascript">

        var scan = new ScanX();
        var viewer;

        $(function () {

            setupViewer();

            setupEvents();

            scan.connect();

        });

        function scanTest() {
            scan.scanTest();
        }

        function setupEvents() {

            scan.connection.on("OnError", (data) => {
                addAlert(data);
            });

            scan.connection.on("OnFinish", () => {
                
            });

            scan.connection.on("OnImageScanned", (data) => {

                var img = '<li><img class="img-fluid" src="data: image/jpeg;base64,' + data.imageBytes + '" onclick="setImageToViewer(this)"></img><p class="text-center">' + data.page + ' <br/><span style="font-size:11px">' + data.size + ' <span></p></li>';

                $("#image-list").append(img);
            });

            scan.connection.onclose(() => {


            })
        }

        function setupViewer() {

            viewer = new Viewer(document.getElementById('image-container'), {
                inline: true,
                viewed: function () {
                    
                },
                title: false,
                navbar: false,
                zoomRatio: 0.2,
                transition: false,
                toolbar: {
                    zoomIn: 4,
                    zoomOut: 4,
                    oneToOne: false,
                    reset: 4,
                    prev: false,
                    play: {
                        show: false,
                        size: 'large',
                    },
                    next: false,
                    rotateLeft: 4,
                    rotateRight: 4,
                    flipHorizontal: 4,
                    flipVertical: 4,
                }
            });
        }
        

        function setImageToViewer(data) {

            var src = $(data).attr("src");

            $("#image-list li img").each(function (i) {
                $(this).removeClass("active");
            })

            $(data).addClass("active");

            $("#image-container").attr("src", src);

            viewer.update();
            
            viewer.next();
        }



    </script>

}
